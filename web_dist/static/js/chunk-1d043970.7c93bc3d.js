(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1d043970"],{1885:function(e,t,a){},"40f7":function(e,t,a){"use strict";var s=a("1885"),r=a.n(s);r.a},7455:function(e,t,a){"use strict";var s=a("7804"),r=a.n(s);r.a},7804:function(e,t,a){},9406:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"dashboard-container"},[e.checkPermission(["acs"])?a("acs"):a("token")],1)},r=[],o=(a("2f62"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"page-container",attrs:{"element-loading-text":"Loading...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("el-card",{staticClass:"dev-detail"},[a("div",{staticClass:"dev-panel"},[a("div",{staticClass:"dev-detail-item"},[e._v("Dev ID: "+e._s(e.devInfo.id))]),a("div",{staticClass:"dev-detail-item"},[e._v("Dev Name: "+e._s(e.devInfo.name))]),a("div",{staticClass:"dev-detail-item"},[e._v("Company Name: "+e._s(e.devInfo.companyName))]),a("div",{staticClass:"sync-span"},[a("el-checkbox",{model:{value:e.face.full,callback:function(t){e.$set(e.face,"full",t)},expression:"face.full"}},[e._v("Full")]),a("el-checkbox",{model:{value:e.face.remove,callback:function(t){e.$set(e.face,"remove",t)},expression:"face.remove"}},[e._v("Remove")]),a("el-progress",{attrs:{percentage:e.face.progress,status:e.face.status}}),a("el-button",{staticClass:"sync-btn",attrs:{type:"primary"},on:{click:e.triggerFaceSync}},[e._v("触发人脸同步")])],1),a("div",{staticClass:"sync-span"},[a("el-checkbox",{model:{value:e.rule.full,callback:function(t){e.$set(e.rule,"full",t)},expression:"rule.full"}},[e._v("Full")]),a("el-checkbox",{model:{value:e.rule.remove,callback:function(t){e.$set(e.rule,"remove",t)},expression:"rule.remove"}},[e._v("Remove")]),a("el-progress",{attrs:{percentage:e.rule.progress,status:e.rule.status}}),a("el-button",{staticClass:"sync-btn",attrs:{type:"primary"},on:{click:e.triggerRuleSync}},[e._v("触发规则同步")])],1),a("el-button",{staticClass:"deactivate-btn",attrs:{type:"primary"},on:{click:e.deactivate}},[e._v("解绑")]),a("el-button",{ref:"btnstartmedia",staticClass:"deactivate-btn",attrs:{type:"primary"},on:{click:e.startmedia}},[e._v(" Start Media ")])],1),a("el-image",{staticClass:"company-logo",attrs:{src:e.devInfo.companyPath,fit:"contain"}})],1),a("el-tabs",{staticClass:"tab-wrapper",attrs:{type:"border-card"},on:{"tab-click":e.changeTab}},[a("el-tab-pane",{attrs:{label:"Member"}},[a("el-button",{staticClass:"deactivate-btn",attrs:{type:"primary"},on:{click:e.reloadMemberData}},[e._v("reload")]),a("el-table",{staticClass:"table-wrapper",staticStyle:{width:"100%"},attrs:{data:e.members,stripe:""}},[a("el-table-column",{attrs:{prop:"uid",label:"uid",width:"180"}}),a("el-table-column",{attrs:{prop:"name",label:"Name",width:"180"}}),a("el-table-column",{attrs:{prop:"workNo",label:"workNo"}}),a("el-table-column",{attrs:{prop:"ruleIds",label:"ruleIds"}}),a("el-table-column",{attrs:{label:"avatar"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-image",{staticClass:"avatar-img",attrs:{src:e.row.avatarUrl,fit:"contain"}})]}}])})],1),e.memberLoadDisable?e._e():a("scroll-loader",{attrs:{"loader-method":e.loadMember,"loader-disable":e.memberLoadDisable,"loader-distance":1800}})],1),a("el-tab-pane",{attrs:{label:"Visitor"}},[a("el-button",{staticClass:"deactivate-btn",attrs:{type:"primary"},on:{click:e.reloadVisitorData}},[e._v("reload")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.visitors,stripe:""}},[a("el-table-column",{attrs:{prop:"uid",label:"uid",width:"180"}}),a("el-table-column",{attrs:{prop:"name",label:"Name",width:"180"}}),a("el-table-column",{attrs:{prop:"inviteReason",label:"inviteReason"}}),a("el-table-column",{attrs:{prop:"allowedDate",label:"allowedDate"}}),a("el-table-column",{attrs:{label:"avatar"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("el-image",{staticClass:"avatar-img",attrs:{src:e.row.avatarUrl,fit:"contain"}})]}}])})],1),e.visitorLoadDisable?e._e():a("scroll-loader",{attrs:{"loader-method":e.loadVisitor,"loader-disable":e.visitorLoadDisable,"loader-distance":1800}})],1),a("el-tab-pane",{attrs:{label:"Rules"}},[a("el-button",{staticClass:"deactivate-btn",attrs:{type:"primary"},on:{click:e.reloadRuleData}},[e._v("reload")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rules,stripe:""}},[a("el-table-column",{attrs:{prop:"id",label:"id",width:"180"}}),a("el-table-column",{attrs:{prop:"name",label:"Name",width:"180"}}),a("el-table-column",{attrs:{prop:"period",label:"period"}}),a("el-table-column",{attrs:{prop:"allowedDate",label:"allowedDate"}}),a("el-table-column",{attrs:{prop:"deniedDate",label:"deniedDate"}})],1)],1),a("el-tab-pane",{attrs:{label:"Report"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:e.uploadUrl,"show-file-list":!1,"on-success":e.handleAvatarSuccess}},[e.imageUrl?a("el-image",{staticClass:"avatar",attrs:{src:e.imageUrl,fit:"contain"}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})],1),a("div",{staticClass:"report-panel"},[a("el-select",{attrs:{placeholder:"Select"},on:{change:e.reportUserTypeChange},model:{value:e.reportUserType,callback:function(t){e.reportUserType=t},expression:"reportUserType"}},e._l(e.userTypes,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1),a("el-select",{staticStyle:{display:"block","margin-top":"10px"},attrs:{disabled:e.reportUserType===e.userTypes[2],"value-key":"name",placeholder:"Select"},model:{value:e.reportUser,callback:function(t){e.reportUser=t},expression:"reportUser"}},e._l(e.reportSelectList,(function(t){return a("el-option",{key:t.uid,staticStyle:{padding:"3px",height:"60px"},attrs:{label:t.name,value:t}},[a("el-image",{staticStyle:{float:"left",width:"48px",height:"48px"},attrs:{fit:"contain",src:t.avatarUrl}}),a("span",{staticStyle:{float:"right","margin-right":"20px",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.name))])],1)})),1),a("div",{staticStyle:{"margin-top":"5px"}},[a("el-input-number",{attrs:{precision:2,step:.1,max:60},model:{value:e.temp,callback:function(t){e.temp=t},expression:"temp"}}),e._v(" 小于0的值表示不进行体温测量 ")],1),a("el-checkbox",{staticStyle:{display:"block","margin-top":"5px"},attrs:{disabled:e.temp<0},model:{value:e.tempOk,callback:function(t){e.tempOk=t},expression:"tempOk"}},[e._v(" 体温符合正常范围 ")]),a("el-checkbox",{staticStyle:{display:"block","margin-top":"5px"},model:{value:e.onlineAccessReport,callback:function(t){e.onlineAccessReport=t},expression:"onlineAccessReport"}},[e._v(" 在线判断权限(在线判断:通过服务端判断用户是否有访问权限; 离线判断:本地判断是否有访问权限，上报只做记录) ")]),a("el-button",{staticClass:"deactivate-btn",staticStyle:{display:"inline-block"},attrs:{type:"primary"},on:{click:e.reportAccess}},[e._v("上报 ")])],1)],1)],1)],1)}),i=[],n=(a("6b54"),a("75fc")),l=a("db72"),c=(a("28a5"),a("7f7f"),a("5c96")),d=(a("a481"),window.location.origin);console.log(d),d=d.replace("http","ws");var u=new WebSocket(d+"/ws");u.onopen=function(e){console.log("acs_ws",e)},u.onerror=function(e){console.log("acs_ws",e)},u.onclose=function(e){console.log("acs_ws",e)};var p=u,m=a("c24f"),b="",f=50,g={name:"Acs",data:function(){return{loading:!0,devInfo:{name:"",id:"",companyName:"",companyLogo:"",companyPath:""},face:{full:!1,remove:!1,progress:0,status:""},rule:{full:!1,remove:!1,progress:0,status:""},imageUrl:"",members:[],visitors:[],rules:[],uploadUrl:b+"upload",userTypes:["Member","Visitor","Unknown"],reportUserType:"",onlineAccessReport:!0,temp:-1,tempOk:!1,reportUser:void 0,reportPicReady:!1,memberLoadDisable:!1,visitorLoadDisable:!1,loadMemberOffset:0,loadVisitorOffset:0,mediastarted:!1}},computed:{reportSelectList:function(){switch(this.reportUserType){case"Member":return this.members;case"Visitor":return this.visitors;default:return[]}}},mounted:function(){p.onmessage=function(e){var t=JSON.parse(e.data);switch(console.log("acs_ws",t),t.api){case"activate":t.success?(this.getDeviceDetail(),this.reloadMemberData(),this.reloadVisitorData(),this.reloadRuleData()):(this.loading=!1,Object(c["Message"])({message:"Activate fail",type:"warning",duration:5e3}));break;case"device_detail":this.devInfo={name:t.name,id:t.devId,companyName:t.companyName,companyLogo:t.companyLogo,companyPath:b+"api/v1/get_image?path="+t.companyLogo};break;case"face_status":switch(t.status){case 1:this.face.status="",this.face.progress=0;break;case 2:var a=t.msg.split("/"),s=0|parseInt(a[0]),r=0|parseInt(a[1]);if(0===r)break;this.face.progress=(s/r*100).toFixed(0);break;case 3:this.face.status="success",this.face.progress=100;break;case 4:this.face.status="exception";break}break;case"rule_status":switch(t.status){case 1:this.rule.status="",this.rule.progress=0;break;case 2:console.log(t);break;case 3:this.rule.status="success",this.rule.progress=100;break;case 4:this.rule.status="exception";break}break;case"report_access":t.canAccess?this.$message({message:"Wow, 开门成功.",type:"success"}):this.$message.error("Oops, 无开门权限.");break;default:Object(c["Message"])({message:t,type:"warning",duration:5e3})}}.bind(this),m["a"]({}).then((function(e){})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})})),this.getmediastate()},methods:{loadMember:function(){var e=this;m["d"]({offset:this.loadMemberOffset,limit:f}).then((function(t){e.loadMemberOffset+=f;var a=t.members.map((function(e){return Object(l["a"])(Object(l["a"])({},e),{},{avatarUrl:b+"api/v1/get_image?path="+e.avatarPath})}));a.length<f&&(e.memberLoadDisable=!0),e.members=[].concat(Object(n["a"])(e.members),Object(n["a"])(a)),console.log(e.members)})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))},loadVisitor:function(){var e=this;m["f"](this.loadVisitorOffset,f).then((function(t){e.loadVisitorOffset+=f;var a=t.visitors.map((function(e){return Object(l["a"])(Object(l["a"])({},e),{},{avatarUrl:b+"api/v1/get_image?path="+e.avatarPath})}));a.length<f&&(e.visitorLoadDisable=!0),e.visitors=[].concat(Object(n["a"])(e.visitors),Object(n["a"])(a))})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))},changeTab:function(e){console.log(e)},reportAccess:function(){var e=this;if(this.reportPicReady){void 0===this.reportUser&&"Unknown"!==this.reportUserType&&Object(c["Message"])({message:"选择上报成员",type:"warning",duration:5e3});var t,a=3,s=this.onlineAccessReport;switch(this.reportUserType){case"Member":a=1,t=this.reportUser.uid;break;case"Visitor":t=this.reportUser.uid,a=2;break;default:t=(new Date).getTime().toString()}var r=this.tempOk,o=this.temp;m["l"]({uid:t,picPath:"acs_report",userType:a,online:s,temp:o,tempOK:r}).then((function(t){s||(t.canAccess?e.$message({message:"Wow, 开门成功.",type:"success"}):e.$message.error("Oops, 无开门权限."))})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))}else Object(c["Message"])({message:"上传上报图片",type:"warning",duration:5e3})},handleAvatarSuccess:function(e,t){this.imageUrl=URL.createObjectURL(t.raw),this.reportPicReady=!0},reportUserTypeChange:function(e){switch(this.reportUser=void 0,this.reportUserType){case"Member":this.reloadMemberData();break;case"Visitor":this.reloadVisitorData();break}},reloadRuleData:function(){var e=this;m["e"]().then((function(t){e.rules=t.rules})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))},reloadMemberData:function(){this.loadMemberOffset=0,this.members=[],this.memberLoadDisable=!1,this.loadMember()},reloadVisitorData:function(){this.loadVisitorOffset=0,this.visitors=[],this.visitorLoadDisable=!1,this.loadVisitor()},triggerRuleSync:function(){m["m"]({full:this.rule.full?1:0,remove:this.rule.remove?1:0}).then((function(e){})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))},triggerFaceSync:function(){m["c"]({full:this.face.full?1:0,remove:this.face.remove?1:0}).then((function(e){})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))},deactivate:function(){m["b"]().then((function(e){})).catch((function(e){Object(c["Message"])({message:e.message||"Error",type:"error",duration:5e3})}))},showmediastarttext:function(){this.mediastarted?this.$refs.btnstartmedia.$el.innerText="Stop Media":this.$refs.btnstartmedia.$el.innerText="Start Media"},getmediastate:function(){var e=this;m["i"]().then((function(t){t.success>0?e.mediastarted=!0:e.mediastarted=!1,e.showmediastarttext()})).catch((function(t){e.mediastarted=!1,e.$message.error(t+"Error: get media state error")}))},startmedia:function(){var e=this;!1===this.mediastarted?m["n"]().then((function(t){!1===t.success&&e.$message.error("Error: Start Media"),e.getmediastate()})).catch((function(t){e.$message.error(t+"Error: Start Media")})):m["o"]().then((function(t){!1===t.success&&e.$message.error("Error: Stop Media"),e.getmediastate()})).catch((function(t){e.$message.error(t+"Error: Stop Media")}))},getDeviceDetail:function(){var e=this;m["g"]().then((function(t){e.devInfo={name:t.name,id:t.devId,companyName:t.companyName,companyLogo:t.companyLogo,companyPath:b+"api/v1/get_image?path="+t.companyLogo}})).catch((function(e){Object(c["Message"])({message:e,type:"error",duration:5e3})})).finally((function(){e.loading=!1}))}}},h=g,v=(a("40f7"),a("2877")),y=Object(v["a"])(h,o,i,!1,null,"504d8442",null),k=y.exports,w=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"page-container",attrs:{"element-loading-text":"Loading...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("el-card",{staticClass:"token-box"},[a("vue-qr-reader",{attrs:{"stop-on-scanned":!1},on:{"code-scanned":e.codeArrived}}),a("div",{staticClass:"desc"},[e._v("设备未激活，输入 token 激活(不填写表示有线配网，不需要token，超时为100秒)")]),a("el-input",{staticClass:"input",attrs:{placeholder:"Input token"},model:{value:e.acs_token,callback:function(t){e.acs_token=t},expression:"acs_token"}}),a("el-button",{attrs:{type:"primary"},on:{click:e.activate}},[e._v("激活")])],1)],1)},_=[],O=a("d8f3"),x=a.n(O),M={name:"Token",components:{VueQrReader:x.a},data:function(){return{acs_token:"",loading:!1}},mounted:function(){p.onmessage=function(e){var t=this;this.loading=!1;var a=JSON.parse(e.data);"activate"===a.api&&(a.success?this.$store.dispatch("user/changeRoles","acs").then((function(){t.$emit("change")})):Object(c["Message"])({message:"Activate fail",type:"warning",duration:5e3}))}.bind(this)},methods:{codeArrived:function(e){this.acs_token=e},activate:function(){var e=this;this.loading=!0,Object(m["a"])({token:this.acs_token}).catch((function(t){e.loading=!1,Object(c["Message"])({message:t.message||"Error",type:"error",duration:5e3})}))}}},D=M,S=(a("7455"),Object(v["a"])(D,w,_,!1,null,"be50e6ae",null)),U=S.exports,C=(a("6762"),a("2fdb"),a("4360"));function j(e){if(e&&e instanceof Array&&e.length>0){var t=C["a"].getters&&C["a"].getters.roles,a=e,s=t.some((function(e){return a.includes(e)}));return!!s}return console.error("need roles! Like v-permission=\"['admin','editor']\""),!1}var L={name:"Dashboard",components:{acs:k,token:U},data:function(){return{currentRole:"token"}},computed:{},methods:{checkPermission:j}},R=L,$=Object(v["a"])(R,s,r,!1,null,null,null);t["default"]=$.exports}}]);